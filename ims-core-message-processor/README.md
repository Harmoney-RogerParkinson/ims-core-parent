#ims-core-message-processor

The role of the Message Processor is to receive messages from the [bayeux](https://en.wikipedia.org/wiki/Comet_(programming)) queue generated by Salesforce triggers which fire when new records/objects are created in the Salesforce database.

Messages describe the new record and the Message Processor gives them an initial check before saving them into a local database. The local database is actually a postgres database normally hosted on AWS.

During this check the Message Processor code will detect if the message is about a transaction that has been reversed. Salesforce normally sets a flag on the transaction in this case. But the Message Processor will generate two transactions, one with a reversed amount. If the transaction was already created but just updated to reversed the Message Processor will just generate the reversal transaction.

There are restart scenarios: the server might restart, the client (ie the Message Processor) might restart. Both need to be handled cleanly. Messages are numbered but not necessarily contiguously. The Message Processor will at least need to remember the last processed message and request new messages from that plus one. That's a db save because if it crashes it won't have memory.

The Message Processor does not process the messages directly. It will probably split them up into several sub-messages (yet to nail down the message format but this seems likely) and save them into an internal queue. The internal queue will include the message number, date stamp and a blob containing the JSON body of the message.

